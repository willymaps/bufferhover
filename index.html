<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<title>Line Hover</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="./css/mapstyle.css" />
<link href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
<style type="text/css">

body {
    font-family: sans-serif;
}

#mapWrap, .credit {
    width:100%;
    display: block;
    font-family: sans-serif;
    color:#555;
    max-width:1200px;
    margin-left: auto;
    margin-right: auto;
}

.credit {
    line-height: 6px;
    font-size: 12px;
    margin-top:20px;
    color:#888;
}

.credit a {
    text-decoration:none;
    color: coral;
}

</style>
</head>

<body>
<div id="mapWrap">
    <div class="column left">
        <h2>Using buffer polygons for easier line selection in Mapbox</h2>
        <p>Generating buffer polygons using <a href="https://docs.mapbox.com/mapbox-gl-js/api/map/#map#queryrenderedfeatures">queryRenderedFeatures</a> and <a href="http://turfjs.org/" target="blank">Turf.js</a>.</p>
        <div id="removeBuffer" class="active">Show Buffer</div>
    </div>
    <div class="column right">
        <div id="map">
            <div id="trailPopup"></div>
        </div>
    </div>
</div>
<div class="credit">
    <p>Data: <a href="https://geohub.lio.gov.on.ca/datasets/mnrf::ontario-trail-network-otn-segment/about" target="_blank">Ontario Trail Network</a></p>
    <p>Code: <a href="https://github.com/willymaps/bufferhover" target="_blank">Github</a></p>
</div>

<script src="./js/linehover.js"></script>
<script>

let initLoad = true;
var mapBounds = [[-79.376220703125,
          44.41220239438348],[-77.9974365234375,
          45.644768217751924]];

document.getElementById("removeBuffer").addEventListener("click", displayBuffer);

// please use your own token!
mapboxgl.accessToken = 'pk.eyJ1Ijoid2lsbGlhbWJlbmRhdmlzIiwiYSI6IlVrb3BGVzQifQ.jeHxDCnpXXvAXKfAFEYG-A';

const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/outdoors-v9',
    center: [-78.5402,45.27],
    zoom: 11.5,
    minZoom: 8,
    maxBounds: mapBounds,
    hash: false
});


map.on('load', function() {

    // load your geojson
    map.addSource('paths', {
      type: 'geojson',
      data: './data/trails.json',
      promoteId: 'OGF_ID'
    });


    // add the points data as circle type
    map.addLayer({
        'id': 'pathsLayer',
        'type': 'line',
        'source': 'paths',
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': [
                'case',
                    ['boolean', ['feature-state', 'hover'], false],
                    'red',
                    '#888'
            ],
            'line-width': [
                'case',
                    ['boolean', ['feature-state', 'hover'], false],
                    4,
                    1
            ],
        }
    });

    // wait for map to render fully
    map.on('render', styleLoaded);

    function styleLoaded () {
      if (map.loaded()) {
        console.log('map loaded');

        queryMap();

        map.off('render', styleLoaded);
        map.on('zoomend', queryMap);
        map.on('moveend', queryMap);
      }
    }

});


// btn function
function displayBuffer() {
    if (bufferShown == true) {
        document.getElementById('removeBuffer').innerHTML = "Show Buffer";
        bufferShown = false;
        map.setPaintProperty('bufferLayer', 'fill-opacity', 0);
    } else {
        bufferShown = true;
        document.getElementById('removeBuffer').innerHTML = "Hide Buffer";
        map.setPaintProperty('bufferLayer', 'fill-opacity', 0.8);
    }
}
</script>
</body>
</html>